<!-- Chosen Palette: Technical Calm (Slate Blue & Warm Neutrals) -->
<!-- Application Structure Plan:
    1. ツール指向ダッシュボード: ユーザーが特定のタスク（圧縮、抽出、文字起こし）を達成することを最優先し、サイドバーで機能を切り替える構造を採用しました。
    2. インタラクティブ・プレイグラウンド: 各セクションに入力フォームとリアルタイム・プレビューを配置。パラメータがコマンドにどう影響するかを直感的に理解可能にします。
    3. データの視覚化: Chart.jsを使用し、「ビットレートによるファイルサイズの変化」や「Whisperモデルの精度と速度のトレードオフ」をグラフ化。数値的な根拠に基づいた選択を支援します。
    4. 統合されたドキュメント: 元のマニュアルの解説文を、ツールのすぐ横に配置。マニュアルを「読みながら使う」体験を提供します。
-->
<!-- Visualization & Content Choices:
    1. 音声圧縮: ビットレート選択に伴うファイルサイズ削減効果をバーチャートで表示。
    2. シーン抽出: 「しきい値（threshold）」の概念を理解するため、変化量の波形と閾値の交差をラインチャートで可視化。
    3. スライド動画化: タイムラインを模したバーチャートで、各画像が表示される長さを可視化。
    4. Whisper: 散布図を用いて、各モデルの「速度」と「精度」の関係を比較し、Turboモデルの優位性を提示。
-->
<!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FFmpeg & Whisper コマンド・スタジオ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
      background-color: #f8fafc;
    }

    /* グラフコンテナのレスポンス定義 */
    .chart-container {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      height: 300px;
      max-height: 400px;
    }

    @media (min-width: 768px) {
      .chart-container { height: 350px; }
    }

    .code-block {
      font-family: 'ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
      background-color: #0f172a;
      color: #e2e8f0;
      overflow-x: auto;
    }

    .active-tab {
      background-color: #eff6ff;
      color: #2563eb;
      border-right: 4px solid #2563eb;
    }

    .fade-in { animation: fadeIn 0.4s ease-out; }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>

<body class="flex flex-col h-screen overflow-hidden">

  <!-- ヘッダー -->
  <header class="bg-white border-b border-slate-200 h-16 flex items-center justify-between px-6 z-30 flex-none shadow-sm">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold text-xl">
        <span>⌘</span>
      </div>
      <div>
        <h1 class="text-lg font-bold text-slate-800">Media Command Studio</h1>
        <p class="text-xs text-slate-500">FFmpeg & Whisper インタラクティブ・マニュアル</p>
      </div>
    </div>
    <div class="hidden md:flex gap-4">
      <span class="text-xs py-1 px-2 bg-slate-100 rounded-full text-slate-600">FFmpeg v6.0+ 対応</span>
      <span class="text-xs py-1 px-2 bg-slate-100 rounded-full text-slate-600">OpenAI Whisper 対応</span>
    </div>
  </header>

  <div class="flex flex-1 overflow-hidden">

    <!-- サイドナビゲーション -->
    <nav class="w-20 md:w-64 bg-white border-r border-slate-200 flex flex-col z-20 overflow-y-auto">
      <div class="p-4 space-y-2">
        <button onclick="switchTab('audio')" id="btn-audio"
          class="w-full flex items-center p-3 rounded-lg text-slate-600 hover:bg-slate-50 transition-all group active-tab">
          <span class="text-xl">🔊</span>
          <span class="ml-3 hidden md:inline font-medium">音声ファイルの圧縮</span>
        </button>

        <button onclick="switchTab('scene')" id="btn-scene"
          class="w-full flex items-center p-3 rounded-lg text-slate-600 hover:bg-slate-50 transition-all group">
          <span class="text-xl">🎞️</span>
          <span class="ml-3 hidden md:inline font-medium">シーン抽出</span>
        </button>

        <button onclick="switchTab('slide')" id="btn-slide"
          class="w-full flex items-center p-3 rounded-lg text-slate-600 hover:bg-slate-50 transition-all group">
          <span class="text-xl">📽️</span>
          <span class="ml-3 hidden md:inline font-medium">スライド動画化</span>
        </button>

        <button onclick="switchTab('whisper')" id="btn-whisper"
          class="w-full flex items-center p-3 rounded-lg text-slate-600 hover:bg-slate-50 transition-all group">
          <span class="text-xl">💬</span>
          <span class="ml-3 hidden md:inline font-medium">AI文字起こし</span>
        </button>

        <!-- ✅ 追加：初心者向けマニュアル -->
        <div class="pt-4 border-t border-slate-100">
          <button onclick="switchTab('manual')" id="btn-manual"
            class="w-full flex items-center p-3 rounded-lg text-slate-600 hover:bg-slate-50 transition-all group">
            <span class="text-xl">📘</span>
            <span class="ml-3 hidden md:inline font-medium">はじめての方へ</span>
          </button>

          <button onclick="switchTab('tips')" id="btn-tips"
            class="w-full flex items-center p-3 rounded-lg text-slate-600 hover:bg-slate-50 transition-all group">
            <span class="text-xl">💡</span>
            <span class="ml-3 hidden md:inline font-medium">逆引きTips</span>
          </button>
        </div>
      </div>
    </nav>

    <!-- メインコンテンツ -->
    <main class="flex-1 overflow-y-auto p-4 md:p-8" id="content-area">

      <!-- 1. 音声圧縮セクション -->
      <section id="section-audio" class="fade-in max-w-5xl mx-auto space-y-8">
        <div class="border-l-4 border-blue-500 pl-4">
          <h2 class="text-2xl font-bold text-slate-800">音声ファイルの圧縮（サイズ軽量化）</h2>
          <p class="text-slate-600 mt-2">音声の品質を維持しつつ、配布や保存に適したファイルサイズに変換します。ビットレートの調整が軽量化の鍵です。</p>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-6">
            <h3 class="font-bold text-slate-700 flex items-center gap-2">
              <span>⚙️</span> パラメータ設定
            </h3>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">入力ファイル名</label>
                <input type="text" id="audio-input" value="ここを変更してください.m4a"
                  class="w-full p-2 border border-slate-200 rounded-lg bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none"
                  oninput="updateAudio()">
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">ビットレート</label>
                <select id="audio-bitrate"
                  class="w-full p-2 border border-slate-200 rounded-lg bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none"
                  onchange="updateAudio()">
                  <option value="32k">32k (最低画質 - 記録用)</option>
                  <option value="64k" selected>64k (推奨 - バランス)</option>
                  <option value="128k">128k (高画質 - 音楽向け)</option>
                  <option value="192k">192k (最高画質)</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">出力ファイル名</label>
                <input type="text" id="audio-output" value="audio_small.m4a"
                  class="w-full p-2 border border-slate-200 rounded-lg bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none"
                  oninput="updateAudio()">
              </div>
            </div>
          </div>

          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col items-center justify-center">
            <h3 class="font-bold text-slate-700 mb-4 w-full">ファイルサイズ削減予測</h3>
            <div class="chart-container">
              <canvas id="audioChart"></canvas>
            </div>
          </div>
        </div>

        <div class="bg-slate-900 rounded-2xl overflow-hidden shadow-lg">
          <div class="bg-slate-800 px-4 py-2 flex justify-between items-center">
            <span class="text-xs text-slate-400 font-mono">Generated Command</span>
            <button onclick="copyToClipboard('audio-cmd')" class="text-xs text-white bg-blue-600 px-2 py-1 rounded hover:bg-blue-500 transition-colors">Copy</button>
          </div>
          <div class="p-6">
            <code id="audio-cmd" class="text-blue-300 block break-all leading-relaxed"></code>
          </div>
        </div>
      </section>

      <!-- 2. シーン抽出セクション -->
      <section id="section-scene" class="fade-in max-w-5xl mx-auto space-y-8 hidden">
        <div class="border-l-4 border-emerald-500 pl-4">
          <h2 class="text-2xl font-bold text-slate-800">動画からの「スライド切り替わり」抽出</h2>
          <p class="text-slate-600 mt-2">映像の変化量を計算し、指定した閾値を超えた瞬間のフレームだけを画像として書き出します。</p>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-6">
            <h3 class="font-bold text-slate-700">⚙️ 抽出条件</h3>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">しきい値 (0.0〜1.0)</label>
                <input type="range" id="scene-threshold" min="0.1" max="0.5" step="0.05" value="0.3"
                  class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"
                  oninput="updateScene()">
                <div class="flex justify-between text-xs text-slate-500 mt-1">
                  <span>敏感 (0.1)</span>
                  <span id="threshold-display" class="font-bold text-emerald-600">0.3</span>
                  <span>鈍感 (0.5)</span>
                </div>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">出力画質 (1-31, 小さいほど高画質)</label>
                <input type="number" id="scene-quality" value="2" min="1" max="31"
                  class="w-full p-2 border border-slate-200 rounded-lg bg-slate-50"
                  oninput="updateScene()">
              </div>
            </div>
          </div>

          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col items-center">
            <h3 class="font-bold text-slate-700 mb-4 w-full">シーン変化検知シミュレーション</h3>
            <div class="chart-container">
              <canvas id="sceneChart"></canvas>
            </div>
          </div>
        </div>

        <div class="bg-slate-900 rounded-2xl overflow-hidden shadow-lg">
          <div class="bg-slate-800 px-4 py-2 flex justify-between items-center">
            <span class="text-xs text-slate-400 font-mono">Generated Command</span>
            <button onclick="copyToClipboard('scene-cmd')" class="text-xs text-white bg-blue-600 px-2 py-1 rounded hover:bg-blue-500">Copy</button>
          </div>
          <div class="p-6">
            <code id="scene-cmd" class="text-emerald-300 block break-all leading-relaxed"></code>
          </div>
        </div>
      </section>

      <!-- 3. スライド動画化セクション -->
      <section id="section-slide" class="fade-in max-w-5xl mx-auto space-y-8 hidden">
        <div class="border-l-4 border-indigo-500 pl-4">
          <h2 class="text-2xl font-bold text-slate-800">画像シーケンスのスライド動画化</h2>
          <p class="text-slate-600 mt-2">連番の静止画を繋ぎ合わせて、スライドショー動画を作成します。</p>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-6">
            <h3 class="font-bold text-slate-700">⚙️ 再生設定</h3>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">表示間隔 (秒/枚)</label>
                <input type="number" id="slide-rate" value="1" min="0.1" step="0.5"
                  class="w-full p-2 border border-slate-200 rounded-lg bg-slate-50"
                  oninput="updateSlide()">
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">動画のフレームレート (FPS)</label>
                <input type="number" id="slide-fps" value="30" min="1" max="60"
                  class="w-full p-2 border border-slate-200 rounded-lg bg-slate-50"
                  oninput="updateSlide()">
              </div>
            </div>
          </div>

          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col items-center">
            <h3 class="font-bold text-slate-700 mb-4 w-full">タイムライン可視化</h3>
            <div class="chart-container">
              <canvas id="slideChart"></canvas>
            </div>
          </div>
        </div>

        <div class="bg-slate-900 rounded-2xl overflow-hidden shadow-lg">
          <div class="bg-slate-800 px-4 py-2 flex justify-between items-center">
            <span class="text-xs text-slate-400 font-mono">Generated Command</span>
            <button onclick="copyToClipboard('slide-cmd')" class="text-xs text-white bg-blue-600 px-2 py-1 rounded hover:bg-blue-500">Copy</button>
          </div>
          <div class="p-6">
            <code id="slide-cmd" class="text-indigo-300 block break-all leading-relaxed"></code>
          </div>
        </div>
      </section>

      <!-- 4. Whisperセクション -->
      <section id="section-whisper" class="fade-in max-w-5xl mx-auto space-y-8 hidden">
        <div class="border-l-4 border-purple-500 pl-4">
          <h2 class="text-2xl font-bold text-slate-800">WhisperによるAI文字起こし</h2>
          <p class="text-slate-600 mt-2">OpenAIの高性能モデルを使用して、音声・動画から正確な日本語テキストを生成します。</p>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-6">
            <h3 class="font-bold text-slate-700">⚙️ AI設定</h3>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">使用モデル</label>
                <select id="whisper-model" class="w-full p-2 border border-slate-200 rounded-lg bg-slate-50" onchange="updateWhisper()">
                  <option value="tiny">tiny (最速 / 精度低)</option>
                  <option value="base">base (高速)</option>
                  <option value="small">small (標準バランス)</option>
                  <option value="medium">medium (高精度 / 重い)</option>
                  <option value="turbo" selected>turbo (最新推奨: 高速・高精度)</option>
                  <option value="large-v3">large-v3 (最高精度 / 非常に重い)</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">対象言語</label>
                <select id="whisper-lang" class="w-full p-2 border border-slate-200 rounded-lg bg-slate-50" onchange="updateWhisper()">
                  <option value="Japanese" selected>Japanese (日本語)</option>
                  <option value="English">English (英語)</option>
                </select>
              </div>
            </div>
          </div>

          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col items-center">
            <h3 class="font-bold text-slate-700 mb-4 w-full">モデル別パフォーマンス比較</h3>
            <div class="chart-container">
              <canvas id="whisperChart"></canvas>
            </div>
          </div>
        </div>

        <div class="bg-slate-900 rounded-2xl overflow-hidden shadow-lg">
          <div class="bg-slate-800 px-4 py-2 flex justify-between items-center">
            <span class="text-xs text-slate-400 font-mono">Generated Command</span>
            <button onclick="copyToClipboard('whisper-cmd')" class="text-xs text-white bg-blue-600 px-2 py-1 rounded hover:bg-blue-500">Copy</button>
          </div>
          <div class="p-6">
            <code id="whisper-cmd" class="text-purple-300 block break-all leading-relaxed"></code>
          </div>
        </div>
      </section>

      <!-- ✅ 5. 初心者向けマニュアルセクション -->
      <section id="section-manual" class="fade-in max-w-4xl mx-auto space-y-8 hidden">
        <div class="border-l-4 border-blue-600 pl-4">
          <h2 class="text-2xl font-bold text-slate-800">はじめての方向け 使い方ガイド</h2>
          <p class="text-slate-600 mt-2">
            「コマンドって難しそう…」という方でも大丈夫。ここは<strong>コピペで安全に使える</strong>前提で書いてあります。
          </p>
        </div>

        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 space-y-8">
          <div class="space-y-2">
            <h3 class="font-bold text-lg text-slate-800">① まず理解するポイント</h3>
            <ul class="text-sm text-slate-600 space-y-2 list-disc list-inside">
              <li><b>このページの「Copy」</b>を押すと、コマンドがクリップボードに入ります。</li>
              <li>あとは<b>黒い画面（ターミナル）に貼り付けてEnter</b>するだけです。</li>
              <li>ファイル名の前後の <b>"</b> は、スペースを含むファイル名でも壊れないための安全策です。</li>
            </ul>
          </div>

          <div class="space-y-2">
            <h3 class="font-bold text-lg text-slate-800">② Windows（最短手順）</h3>
            <ol class="text-sm text-slate-600 space-y-2 list-decimal list-inside">
              <li>キーボードの <b>Windowsキー + R</b></li>
              <li><b>cmd</b> と入力 → Enter</li>
              <li>このページの <b>Copy</b> を押す</li>
              <li>黒い画面で<b>右クリック</b>（貼り付け）→ <b>Enter</b></li>
            </ol>
            <div class="mt-3 p-3 rounded-xl bg-slate-50 border border-slate-200 text-sm text-slate-600">
              うまくいかない時は「ファイルがあるフォルダで実行」できていないことが多いです。<br>
              まずはエクスプローラーでファイルのある場所を開き、アドレスバーに <b>cmd</b> と打ってEnterすると、その場所でコマンドが開けます。
            </div>
          </div>

          <div class="space-y-2">
            <h3 class="font-bold text-lg text-slate-800">③ Mac（最短手順）</h3>
            <ol class="text-sm text-slate-600 space-y-2 list-decimal list-inside">
              <li><b>Command + Space</b> を押す</li>
              <li><b>terminal</b> と入力 → Enter</li>
              <li>このページの <b>Copy</b> を押す</li>
              <li>ターミナルで<b>Command + V</b>（貼り付け）→ <b>Enter</b></li>
            </ol>
          </div>

          <div class="space-y-2">
            <h3 class="font-bold text-lg text-slate-800">④ 事前チェック（導入確認）</h3>
            <div class="grid md:grid-cols-2 gap-4">
              <div class="p-4 rounded-2xl bg-slate-50 border border-slate-200">
                <p class="text-sm text-slate-700 font-bold mb-2">FFmpeg が入っているか？</p>
                <div class="bg-slate-900 rounded-xl overflow-hidden">
                  <div class="p-3">
                    <code class="text-slate-200 text-sm">ffmpeg -version</code>
                  </div>
                </div>
                <p class="text-sm text-slate-600 mt-2">情報が出ればOK。出ない場合はFFmpegのインストールが必要です。</p>
              </div>

              <div class="p-4 rounded-2xl bg-slate-50 border border-slate-200">
                <p class="text-sm text-slate-700 font-bold mb-2">Whisper が入っているか？</p>
                <div class="bg-slate-900 rounded-xl overflow-hidden">
                  <div class="p-3">
                    <code class="text-slate-200 text-sm">whisper --help</code>
                  </div>
                </div>
                <p class="text-sm text-slate-600 mt-2">ヘルプが出ればOK。出ない場合はWhisperのセットアップが必要です。</p>
              </div>
            </div>
          </div>

          <div class="space-y-2">
            <h3 class="font-bold text-lg text-slate-800">⑤ よくあるエラー原因</h3>
            <ul class="text-sm text-slate-600 space-y-2 list-disc list-inside">
              <li><b>No such file or directory</b>：入力ファイル名が違う / そのフォルダにファイルがない</li>
              <li><b>'ffmpeg' is not recognized</b>：FFmpegが未インストール or PATH未設定</li>
              <li><b>Permission denied</b>：出力先の書き込み権限がない（別フォルダで試す）</li>
            </ul>
          </div>

          <div class="space-y-2">
            <h3 class="font-bold text-lg text-slate-800">⑥ セキュリティについて</h3>
            <p class="text-sm text-slate-600 leading-relaxed">
              このページは「コマンドを作るだけ」です。実際の変換や抽出は<b>あなたのPC内で完結</b>します。<br>
              外部にファイルを送信しないため、社内資料や顧客データでも扱いやすい構成です。
            </p>
          </div>

          <div class="p-4 rounded-2xl bg-blue-50 border border-blue-100">
            <p class="text-sm text-slate-700">
              ✅ まずは左メニューの「音声圧縮」→ Copy → 実行、で1回成功させるのが最短です。
            </p>
          </div>
        </div>
      </section>

      <!-- 6. Tipsセクション -->
      <section id="section-tips" class="fade-in max-w-5xl mx-auto space-y-6 hidden">
        <div class="border-l-4 border-amber-500 pl-4 mb-8">
          <h2 class="text-2xl font-bold text-slate-800">実用逆引き Tips</h2>
          <p class="text-slate-600 mt-2">よくあるトラブルや効率化のためのヒント集です。</p>
        </div>

        <div class="grid md:grid-cols-2 gap-6">
          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 border-t-4 border-t-amber-400">
            <h3 class="font-bold text-slate-800 text-lg mb-2">📁 スペースを含むファイル名</h3>
            <p class="text-sm text-slate-600 leading-relaxed">ファイル名にスペースが含まれる場合は、必ず "ダブルクォーテーション" で囲んでください。コマンドが途切れて認識されるのを防ぎます。</p>
          </div>

          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 border-t-4 border-t-blue-400">
            <h3 class="font-bold text-slate-800 text-lg mb-2">⚡ GPUによる高速化</h3>
            <p class="text-sm text-slate-600 leading-relaxed">WhisperはNVIDIA等のGPU環境があれば自動的に認識し、処理速度を劇的に向上させます。CPUのみの場合は small や turbo モデルが現実的です。</p>
          </div>

          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 border-t-4 border-t-emerald-400">
            <h3 class="font-bold text-slate-800 text-lg mb-2">🛠️ FFmpegの導入確認</h3>
            <p class="text-sm text-slate-600 leading-relaxed">ターミナルで <code>ffmpeg -version</code> と入力し、情報が表示されれば利用準備は完了しています。</p>
          </div>

          <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 border-t-4 border-t-indigo-400">
            <h3 class="font-bold text-slate-800 text-lg mb-2">🖼️ シーン抽出の微調整</h3>
            <p class="text-sm text-slate-600 leading-relaxed">抽出される枚数が多すぎる場合は、しきい値を 0.3 から 0.4 に上げてください。逆に少ない場合は 0.2 などに下げて「感度」を高めます。</p>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- コピートースト -->
  <div id="toast"
    class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-6 py-3 rounded-full text-sm font-bold shadow-2xl opacity-0 transition-opacity pointer-events-none z-50">
    コマンドをコピーしました
  </div>

  <script>
    // --- 状態管理 ---
    const charts = {};

    // --- タブ切り替え ---
    function switchTab(tabId) {
      // 全セクション非表示
      document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
      // ターゲット表示
      const target = document.getElementById(`section-${tabId}`);
      if (target) target.classList.remove('hidden');

      // ボタンのスタイル更新
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-tab'));
      const btn = document.getElementById(`btn-${tabId}`);
      if (btn) btn.classList.add('active-tab');

      // グラフの再描画（隠れていたタブのcanvasサイズ調整のため）
      if (charts[tabId]) charts[tabId].update();
    }

    // --- 音声圧縮ロジック ---
    function updateAudio() {
      const input = document.getElementById('audio-input').value;
      const bitrate = document.getElementById('audio-bitrate').value;
      const output = document.getElementById('audio-output').value;

      const cmd = `ffmpeg -y -i "${input}" -acodec aac -b:a ${bitrate} "${output}"`;
      document.getElementById('audio-cmd').innerText = cmd;

      // グラフ更新
      if (charts.audio) {
        const ratioMap = { '32k': 0.05, '64k': 0.10, '128k': 0.20, '192k': 0.30 };
        charts.audio.data.datasets[0].data = [100, (100 * ratioMap[bitrate]).toFixed(1)];
        charts.audio.update();
      }
    }

    // --- シーン抽出ロジック ---
    function updateScene() {
      const input = "ここを変更してください.mp4"; // 固定デモ用
      const threshold = document.getElementById('scene-threshold').value;
      const quality = document.getElementById('scene-quality').value;

      document.getElementById('threshold-display').innerText = threshold;

      const cmd = `ffmpeg -i "${input}" -vf "select=gt(scene\\\\,${threshold})" -fps_mode vfr -q:v ${quality} slide_%04d.jpg`;
      document.getElementById('scene-cmd').innerText = cmd;

      if (charts.scene) {
        charts.scene.data.datasets[1].data = Array(12).fill(parseFloat(threshold));
        charts.scene.update();
      }
    }

    // --- スライド動画ロジック ---
    function updateSlide() {
      const rate = parseFloat(document.getElementById('slide-rate').value || "1");
      const fps = document.getElementById('slide-fps').value;

      const fr = rate > 0 ? (1 / rate) : 1;
      const cmd = `ffmpeg -framerate ${fr} -i slide_%04d.jpg -c:v libx264 -r ${fps} -pix_fmt yuv420p slideshow.mp4`;
      document.getElementById('slide-cmd').innerText = cmd;

      if (charts.slide) {
        charts.slide.data.datasets[0].data = Array(5).fill(rate);
        charts.slide.update();
      }
    }

    // --- Whisperロジック ---
    function updateWhisper() {
      const model = document.getElementById('whisper-model').value;
      const lang = document.getElementById('whisper-lang').value;

      const cmd = `whisper "ここを変更してください.mp4" --language ${lang} --model ${model}`;
      document.getElementById('whisper-cmd').innerText = cmd;

      if (charts.whisper) {
        const models = ['tiny', 'base', 'small', 'medium', 'turbo', 'large-v3'];
        charts.whisper.data.datasets[0].backgroundColor =
          models.map(m => (m === model ? '#8b5cf6' : '#e2e8f0'));
        charts.whisper.update();
      }
    }

    // --- ユーティリティ ---
    function copyToClipboard(elementId) {
      const el = document.getElementById(elementId);
      const text = el ? el.innerText : "";
      const dummy = document.createElement("textarea");
      document.body.appendChild(dummy);
      dummy.value = text;
      dummy.select();
      document.execCommand("copy");
      document.body.removeChild(dummy);

      const toast = document.getElementById('toast');
      toast.style.opacity = '1';
      setTimeout(() => toast.style.opacity = '0', 2000);
    }

    // --- グラフ初期化 ---
    function initCharts() {
      // Audio Bar Chart
      charts.audio = new Chart(document.getElementById('audioChart'), {
        type: 'bar',
        data: {
          labels: ['変換前', '変換後'],
          datasets: [{
            label: 'ファイルサイズ (相対値)',
            data: [100, 10],
            backgroundColor: ['#cbd5e1', '#3b82f6'],
            borderRadius: 8
          }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: false } }
      });

      // Scene Line Chart
      charts.scene = new Chart(document.getElementById('sceneChart'), {
        type: 'line',
        data: {
          labels: ['1s','2s','3s','4s','5s','6s','7s','8s','9s','10s','11s','12s'],
          datasets: [
            {
              label: '映像変化量',
              data: [0.05, 0.08, 0.6, 0.04, 0.05, 0.1, 0.45, 0.06, 0.04, 0.55, 0.05, 0.08],
              borderColor: '#10b981',
              tension: 0.4,
              fill: true,
              backgroundColor: 'rgba(16, 185, 129, 0.1)'
            },
            {
              label: 'しきい値',
              data: Array(12).fill(0.3),
              borderColor: '#ef4444',
              borderDash: [5, 5],
              pointRadius: 0
            }
          ]
        },
        options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 0, max: 1 } } }
      });

      // Slide Timeline Chart
      charts.slide = new Chart(document.getElementById('slideChart'), {
        type: 'bar',
        data: {
          labels: ['Image 1', 'Image 2', 'Image 3', 'Image 4', 'Image 5'],
          datasets: [{ label: '表示秒数', data: [1,1,1,1,1], backgroundColor: '#6366f1', borderRadius: 4 }]
        },
        options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: false } }
      });

      // Whisper Bubble Plot
      charts.whisper = new Chart(document.getElementById('whisperChart'), {
        type: 'bubble',
        data: {
          datasets: [{
            label: '性能マップ',
            data: [
              { x: 10, y: 3,   r: 10 }, // tiny
              { x: 8,  y: 5,   r: 10 }, // base
              { x: 6,  y: 7,   r: 10 }, // small
              { x: 4,  y: 9,   r: 10 }, // medium
              { x: 9,  y: 8.5, r: 15 }, // turbo
              { x: 2,  y: 10,  r: 10 }  // large-v3
            ],
            backgroundColor: ['#e2e8f0','#e2e8f0','#e2e8f0','#e2e8f0','#8b5cf6','#e2e8f0']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { title: { display: true, text: '処理スピード (速 →)' }, min: 0, max: 12 },
            y: { title: { display: true, text: '精度 (高 →)' }, min: 0, max: 12 }
          }
        }
      });
    }

    window.onload = () => {
      initCharts();
      updateAudio();
      updateScene();
      updateSlide();
      updateWhisper();
    };
  </script>
</body>
</html>
